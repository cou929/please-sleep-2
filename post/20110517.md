{"title":"DOM の textContent と innerText について","date":"2011-05-17T12:00:00+09:00","tags":["javascript"]}

<!-- DATE: 2011-05-17T23:54:41+00:00 -->
<!-- OLDURL: http://d.hatena.ne.jp/cou929_la/20110517/ -->


<div class="section">
<p>一つ前のエントリで JavaScript のトピックスについて紹介しました.</p>
<p><a href="http://d.hatena.ne.jp/cou929_la/20110515/1305468296" target="_blank"> 避けなければいけない JavaScript の失敗 - フリーフォーム フリークアウト</a></p>
<p>この中でエレメントノードのテキスト部分を取り出す innerText プロパティについて説明していましたが, これは非標準で Firefox ではサポートされていません. 標準になっているものとして textContent というプロパティがあります.</p>
<p>一応エントリ下部のコメント欄紹介ページでこのことについて触れているんですが, もっときちんと取り上げないとフェアじゃない気がしたので, 改めてこの2つのプロパティについて取り急ぎエントリにしました.</p>
<h4> 仕様とブラウザサポート</h4>
<p>textContent も innerText もある要素の text 部分にアクセスするためのプロパティです. 例えばこのような html に</p>
<pre class="syntax-highlight">
<span class="synIdentifier"><</span><span class="synStatement">div</span><span class="synIdentifier"> </span><span class="synType">id</span><span class="synIdentifier">=</span><span class="synConstant">"myDiv"</span><span class="synIdentifier">></span>
     This text is in Div.
     <span class="synIdentifier"><</span><span class="synStatement">p</span><span class="synIdentifier">></span>A para in div element.<span class="synIdentifier"></</span><span class="synStatement">p</span><span class="synIdentifier">></span>
<span class="synIdentifier"></</span><span class="synStatement">div</span><span class="synIdentifier">></span>
</pre>

<p>こういうふうに js からアクセスすると</p>
<pre class="syntax-highlight">
<span class="synStatement">document</span>.getElementById(<span class="synConstant">'myDiv'</span>).innerText;
<span class="synComment">// または</span>
<span class="synStatement">document</span>.getElementById(<span class="synConstant">'myDiv'</span>).textContent;
</pre>

<p>このような文字列が返されます.</p>
<pre>
This text is in DIV. A para in div element.
</pre>

<p>Chrome で実行してみた例:</p>
<p><a href="http://f.hatena.ne.jp/cou929_la/20110517235044" class="hatena-fotolife" target="_blank"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/c/cou929_la/20110517/20110517235044.png" alt="f:id:cou929_la:20110517235044p:image" title="f:id:cou929_la:20110517235044p:image" class="hatena-fotolife"></a></p>
<p>textContent は <a href="http://www.w3.org/TR/DOM-Level-3-Core/core.html#Node3-textContent" target="_blank">W3C で標準化されたプロパティ</a>です. IE 以外のブラウザがサポートしています. </p>
<p>innerText は IE4 から実装されている IE の独自機能です. Firefox 以外のすべてのブラウザがサポートしています. IE 独自のものなので明文化された仕様はありません.</p>
<p>サイ本6版では次のような, ちょっとクロスブラウザな textContent 関数が紹介されていました. ノードの text が空文字列だった場合, "" は JavaScript では falsy なので, "===" で比較しているのがポイントですね.</p>
<pre class="syntax-highlight">
<span class="synComment">/**</span>
<span class="synComment"> * With one argument, return the textContent or innerText of the element.</span>
<span class="synComment"> * With two arguments, set the textContent or innerText of element to value.</span>
<span class="synComment"> */</span>
<span class="synIdentifier">function</span> textContent(element, value) <span class="synIdentifier">{</span>
    <span class="synIdentifier">var</span> content = element.textContent; <span class="synComment">// Check if textContent is defined</span>
    <span class="synStatement">if</span> (value === <span class="synStatement">undefined</span>) <span class="synIdentifier">{</span> <span class="synComment">// No value passed, so return current text</span>
        <span class="synStatement">if</span> (content !== <span class="synStatement">undefined</span>) <span class="synStatement">return</span> content;
        <span class="synStatement">else</span> <span class="synStatement">return</span> element.innerText;
    <span class="synIdentifier">}</span>
    <span class="synStatement">else</span> <span class="synIdentifier">{</span> <span class="synComment">// A value was passed, so set text</span>
        <span class="synStatement">if</span> (content !== <span class="synStatement">undefined</span>) element.textContent = value;
        <span class="synStatement">else</span> element.innerText = value;
    <span class="synIdentifier">}</span>
<span class="synIdentifier">}</span>
</pre>

<h4> 両者の違い</h4>
<p>両者はだいたい同じような挙動をしますが, いくつかの点では異なっています.</p>

<ul>
<li> textContent は script タグの中を返しますが, innerText は返しません</li>
<li> textContent は空白類の文字 (スペース・タブ・改行など) を html に書いてあるまま返します. innerText はある程度見やすいように変換します</li>
</ul>
<h4> innerText の挙動の違い</h4>
<p>上で述べたように, textContent と innerText の挙動が異なるため, 得られる text も違うものになります. 問題は innerText の挙動もブラウザによって微妙に異なる点です. こちらのブログでは WebKit と IE の innerText で得られるテキストの違いについて触れられています.</p>
<p><a href="http://clubajax.org/plain-text-vs-innertext-vs-textcontent/" target="_blank">Plain Text vs innerText vs textContent by Mike Wilcox  » Club✩AJAX</a></p>
<p>またこちらの stackoverflow の回答では, safari 2.x 系での innerText の実装が buggy であると言われています.</p>
<p><a href="http://stackoverflow.com/questions/1359469/innertext-works-in-ie-but-not-in-firefox" target="_blank">javascript - 'innerText' works in IE, but not in Firefox - Stack Overflow</a></p>
<h4> 問題への対策</h4>
<p>先ほどのブログではブラウザ間の挙動を吸収するような "getPlainText()" という関数が紹介されていました.</p>
<p><a href="http://clubajax.org/files/lang/plain-text.js" target="_blank">http://clubajax.org/files/lang/plain-text.js</a></p>
<p>ただ, 個人的には上の StackOverflow での <a href="http://twitter.com/#!/kangax" target="_blank">kangax</a> さんの意見に共感しました.</p>

<ul>
<li> innerText や textContent の挙動の差異を吸収するのは大変</li>
<li> なので, まず要件をもう一度みなおして本当に textContent / innerText が必要か考える. 大抵の場合は innerHTML からタグを取り除くだけで十分.</li>
<li> 無理ならば DOM Tree を走査して Text ノードを見ていく</li>
</ul>
<h4> 余談: インラインの script タグ</h4>
<p>ちょっと話はそれますが, script タグのちょっと面白い利用法について.</p>
<p>サイ本6版のコラムにもあったのですが, script タグに src 属性を指定せずタグ中に文字列を書くと, ブラウザ上には表示されない文字列になります. 中の文字列は text というプロパティで取得できます. また script 要素の type 属性に "text/javascript" 以外の値を指定すれば JavaScript の処理系もこれを無視してくれます. これを利用すると JavaScript から自由に扱える文字列を script タグの中に書いておくことができます.</p>
<p>現実の利用例としては, <a href="http://ejohn.org/blog/javascript-micro-templating/" target="_blank">John Resig さんがブログで紹介していた小さな関数</a> や <a href="http://icanhazjs.com/" target="_blank">ICanHaz</a> といった js 製のテンプレートエンジンは script タグ (type は text/html) の中にテンプレートを記述するというアプローチをとっています.</p>
<h4> 参考</h4>

<ul>
<li> <a href="http://www.w3.org/TR/DOM-Level-3-Core/core.html#Node3-textContent" target="_blank">Document Object Model Core</a>

<ul>
<li> W3C の仕様</li>
</ul>
</li>
<li> <a href="http://clubajax.org/plain-text-vs-innertext-vs-textcontent/" target="_blank">Plain Text vs innerText vs textContent by Mike Wilcox  » Club✩AJAX</a>

<ul>
<li> 両プロパティの違いについて実例が載っていてわかりやすい</li>
</ul>
</li>
<li> <a href="http://stackoverflow.com/questions/1359469/innertext-works-in-ie-but-not-in-firefox" target="_blank">javascript - 'innerText' works in IE, but not in Firefox - Stack Overflow</a>

<ul>
<li> kangax さんの answer が good</li>
</ul>
</li>
<li> <a href="http://ejohn.org/blog/javascript-micro-templating/" target="_blank">John Resig -   JavaScript Micro-Templating</a>

<ul>
<li> John Resig さんのテンプレート関数. script タグ内にテンプレート文字列を記述</li>
</ul>
</li>
<li> <a href="http://icanhazjs.com/" target="_blank">icanhazjs.com - Blog</a>

<ul>
<li> 上と似たアプローチの js 製テンプレートエンジン</li>
</ul>
</li>
</ul>
</div>






<div class="amazlet-box" style="margin-bottom:0px;"><div class="amazlet-image" style="float:left;margin:0px 12px 1px 0px;"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4873117836/pleasesleep-22/ref=nosim/" name="amazletlink" target="_blank"><img src="https://images-fe.ssl-images-amazon.com/images/I/51U44SJi3jL._SL160_.jpg" alt="初めてのJavaScript 第3版 ―ES2015以降の最新ウェブ開発" style="border: none;" /></a></div><div class="amazlet-info" style="line-height:120%; margin-bottom: 10px"><div class="amazlet-name" style="margin-bottom:10px;line-height:120%"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4873117836/pleasesleep-22/ref=nosim/" name="amazletlink" target="_blank">初めてのJavaScript 第3版 ―ES2015以降の最新ウェブ開発</a><div class="amazlet-powered-date" style="font-size:80%;margin-top:5px;line-height:120%">posted with <a href="http://www.amazlet.com/" title="amazlet" target="_blank">amazlet</a> at 20.03.08</div></div><div class="amazlet-detail">Ethan Brown <br />オライリージャパン <br />売り上げランキング: 17,881<br /></div><div class="amazlet-sub-info" style="float: left;"><div class="amazlet-link" style="margin-top: 5px"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4873117836/pleasesleep-22/ref=nosim/" name="amazletlink" target="_blank">Amazon.co.jpで詳細を見る</a></div></div></div><div class="amazlet-footer" style="clear: left"></div></div>
